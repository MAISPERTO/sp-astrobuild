---
import client from '../lib/directus';
import { readItems } from '@directus/sdk';

// Busca até 50 bairros e 12 categorias locais (ajustável depois)
const [bairros, categoriasLocais] = await Promise.all([
  client.request(
    readItems('mp_bairros', {
      limit: 50,
      sort: ['nome_bairro'],
    })
  ),
  client.request(
    readItems('mp_categorias_locais', {
      limit: 12,
      sort: ['ordem_exibicao', 'nome_nicho'],
      filter: {
        ativo: { _eq: true },
        // se existir o campo nivel_nicho, podemos mostrar só o nível 1:
        // nivel_nicho: { _eq: 1 }
      },
    })
  ),
]);
---

<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <title>São Paulo • Negócios Locais MAISPERTO</title>
  </head>
  <body style="font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; padding: 2rem; background: #f5f5f7;">
    <header style="max-width: 960px; margin: 0 auto 2rem auto;">
      <h1 style="margin: 0 0 0.5rem 0; font-size: 2rem;">
        São Paulo • Negócios Locais MAISPERTO
      </h1>
      <p style="margin: 0; color: #555;">
        Versão inicial de testes conectada ao Directus. Listando bairros e categorias locais cadastradas.
      </p>
    </header>

    <main style="max-width: 960px; margin: 0 auto; display: grid; grid-template-columns: 2fr 1.5fr; gap: 2rem;">
      <!-- Coluna bairros -->
      <section>
        <h2 style="font-size: 1.4rem; margin-bottom: 0.75rem;">Bairros cadastrados</h2>

        {bairros.length === 0 ? (
          <p>Nenhum bairro cadastrado ainda em <code>mp_bairros</code>.</p>
        ) : (
          <ul style="list-style: none; padding: 0; margin: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 0.5rem;">
            {bairros.map((b) => (
              <li>
                <a
                  href={`/${b.slug_bairro}`}
                  style="display: block; padding: 0.5rem 0.75rem; border-radius: 999px; background: white; border: 1px solid #ddd; text-decoration: none; color: #333; font-size: 0.95rem;"
                >
                  {b.nome_bairro}
                </a>
              </li>
            ))}
          </ul>
        )}
      </section>

      <!-- Coluna categorias locais -->
      <section>
        <h2 style="font-size: 1.4rem; margin-bottom: 0.75rem;">Categorias locais</h2>

        {categoriasLocais.length === 0 ? (
          <p>Nenhuma categoria cadastrada ainda em <code>mp_categorias_locais</code>.</p>
        ) : (
          <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.5rem;">
            {categoriasLocais.map((c) => (
              <li>
                <a
                  href={`/${c.full_slug_nicho}`}
                  style="text-decoration: none; color: inherit;"
                >
                  <div
                    style="padding: 0.6rem 0.75rem; border-radius: 0.75rem; background: white; border: 1px solid #ddd;"
                  >
                    <div style="font-weight: 600; margin-bottom: 0.15rem;">
                      {c.nome_nicho}
                    </div>
                    {c.descricao_curta_nicho && (
                      <div style="font-size: 0.9rem; color: #555;">
                        {c.descricao_curta_nicho}
                      </div>
                    )}
                  </div>
                </a>
              </li>
            ))}
          </ul>
        )}
      </section>
    </main>

    <footer style="max-width: 960px; margin: 2rem auto 0 auto; font-size: 0.8rem; color: #777;">
      <p style="margin: 0;">
        MVP • Dados carregados via Directus (<code>mp_bairros</code> e <code>mp_categorias_locais</code>).
      </p>
    </footer>
  </body>
</html>
